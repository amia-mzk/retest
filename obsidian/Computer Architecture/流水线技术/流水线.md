
* 流水线技术是从时间重叠方面达成并行的
* 用时空图或连接图表示
* 使用锁存器（流水寄存器）对齐不同指令的阶段时长

## 分类
### 按功能
* 单功能
* 多功能

### 按连接方式
* 静态
* 动态
### 按级别
* 部件级
* 指令级
* 处理器间

## 性能计算
### 吞吐率
执行指令条数/执行时间
$$
P=\frac{n}{T_n}
$$
### 加速比
顺序执行用时/流水线用时
$$
S=\frac{T_s}{T_k}
$$
### 流水线效率（设备利用率）
k段流水线，n条指令
$$
E=\frac{n\Delta t}{T_k}=\frac{S}{k}
$$


## 经典5段流水线
1. 取指（IF） 
2. 译码（ID）
	1. 从寄存器中读数
3. 执行（EX）
	1. ALU计算
	2. load/store 时形成有效访存地址
	3. 分支时形成目标地址
4. 访存（MEM）
	1. S/L 时读写数据
	2. 分支成功时将转移目标存入PC
	3. ALU操作为空
5. 写回（WB）
	1. ALU操作时，数据来自ALU
	2. load 操作时数据来自存储器
	3. store和分支为空操作


* 访存（MEM）与取指（IF）阶段可能存在冲突
	* 取指与取数用同一套设备
	* 采用指令数据分离的结构或缓存
* 写回（WB）与译码（ID）阶段可能冲突
	* 写后读问题
	* 流水再细分，前半周期写，后半周期读

## 相关与冲突
### 数据相关
1. 写后读（RAW/WR）：真相关
2. 读后写（RW）：反相关
3. 写后写（WW）：输出相关
### 结构相关
* 多个指令同时访问同一处硬件

### 控制相关
* 也称为分支冒险，与分支指令有关

## 冒险的解决
### 流水线气泡
插入NOP指令来避免冒险，如果插入足够多NOP（等于流水线的级数）导致流水线排空，则称为**冲刷流水线**（flushing the pipeline）


### 数据相关
1. 写后读：流水线气泡
2. 寄存器重命名
3. 寄存器直通（转发）机制

### 控制相关
1. 流水线气泡
2. 分支预测
	1. 分支预测成功
		1. 在五段流水中无益处
	2. 分支预测失败
		1. 若预测错误则延迟一个周期
3. 延迟槽
	1. 在前一条指令执行完毕之前，延迟槽中指令的执行不会修改处理器的状态
	2. 分支延迟槽



